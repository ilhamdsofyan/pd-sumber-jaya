# ----------------------------------------------------------------------
# Core WordPress Security Rules (Dynamic Path)
# ----------------------------------------------------------------------

Options -Indexes

<FilesMatch "^(wp-config\.php|_?error_log|readme\.html|license\.txt|php\.ini)$">
    Require all denied
</FilesMatch>

<FilesMatch "^\.">
    Require all denied
</FilesMatch>
<FilesMatch "^\.well-known">
    Require all granted
</FilesMatch>

<Files xmlrpc.php>
    Require all denied
</Files>

# ----------------------------------------------------------------------
# DISABLE PHP EXECUTION IN UPLOADS (Dynamic Path)
# ----------------------------------------------------------------------
<IfModule mod_rewrite.c>
    RewriteRule ^wp-content/uploads/.*\.(php|php5|php4|php3|phtml|pl|py|jsp|asp|sh|cgi)$ - [F,L]
</IfModule>

# ----------------------------------------------------------------------
# WordPress Core Rewrite Rules (Dynamic)
# ----------------------------------------------------------------------
# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
RewriteBase /wordpress
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
# END WordPress

# ----------------------------------------------------------------------
# Security Headers & Content Security Policy (FIXED for data: URLs)
# ----------------------------------------------------------------------
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=()"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains" env=HTTPS
    Header always unset Server
    Header always unset X-Powered-By
    
    # âœ… FIXED CSP: Added 'data:' to font-src and img-src for WordPress admin icons/fonts
    Header always set Content-Security-Policy "\
        default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval'; \
        script-src 'self' 'unsafe-inline' 'unsafe-eval' \
            https://www.google-analytics.com \
            https://ssl.google-analytics.com \
            https://www.googletagmanager.com \
            https://www.googleadservices.com \
            https://googleads.g.doubleclick.net \
            https://tpc.googlesyndication.com \
            https://www.google.com \
            https://www.gstatic.com; \
        img-src 'self' data: https: \
            https://ps.w.org \
            https://www.google-analytics.com \
            https://ssl.google-analytics.com \
            https://www.google.com \
            https://googleads.g.doubleclick.net \
            https://stats.g.doubleclick.net \
            https://secure.gravatar.com \
            https://lh3.googleusercontent.com \
            http://*.gravatar.com; \
        style-src 'self' 'unsafe-inline' https: data: \
            https://fonts.googleapis.com \
            https://www.google.com; \
        font-src 'self' data: https: \
            https://fonts.gstatic.com \
            https://www.google.com; \
        connect-src 'self' https: \
            https://www.google-analytics.com \
            https://stats.g.doubleclick.net \
            https://region1.google-analytics.com; \
        frame-src 'self' blob: https: \
            https://www.google.com \
            https://www.googletagmanager.com \
            https://bid.g.doubleclick.net \
            https://www.youtube.com \
            https://www.youtube-nocookie.com \
            https://player.vimeo.com; \
        media-src 'self' https: data:; \
        object-src 'none'; \
        base-uri 'self'; \
        form-action 'self'; \
        "
</IfModule>

# ----------------------------------------------------------------------
# Performance: GZIP Compression
# ----------------------------------------------------------------------
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json application/xml application/rss+xml application/atom+xml image/svg+xml
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
</IfModule>

# ----------------------------------------------------------------------
# Performance: Browser Caching
# ----------------------------------------------------------------------
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/font-woff "access plus 1 year"
    ExpiresByType application/font-woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/otf "access plus 1 year"
    ExpiresByType application/json "access plus 0 seconds"
    ExpiresByType application/xml "access plus 0 seconds"
</IfModule>

# ----------------------------------------------------------------------
# PHP Limits (if mod_php is available)
# ----------------------------------------------------------------------
<IfModule mod_php.c>
    php_value upload_max_filesize 64M
    php_value post_max_size 64M
    php_value max_execution_time 300
    php_value max_input_time 300
    php_value memory_limit 256M
</IfModule>